[include fluidd.cfg]
# Mainsail settings
[include mainsail.cfg]
[include changes/macros/*.cfg]

# Printer USB Serial Port: usb-1a86_USB_Serial-if00-port0

# klipper config
[stepper_x]
step_pin: PA11
dir_pin: !PA12
enable_pin: !PA8
microsteps: 16
rotation_distance: 40 #39.88 #reaches 99.70
endstop_pin: !PA15
position_endstop: 0
position_max: 320
homing_speed: 40.0
second_homing_speed: 5.0

[stepper_y]
step_pin: PD15
dir_pin: PD3
enable_pin: !PD14
microsteps: 16
rotation_distance: 40 # 39.72 #reaches only 99.30
endstop_pin: !PD4
position_endstop: -5
position_min: -5
position_max: 320
homing_speed: 40.0
second_homing_speed: 5.0

# Z0
[stepper_z]
step_pin: PD6
dir_pin: PD7
enable_pin: !PD5
microsteps: 16
rotation_distance: 8
endstop_pin: PD10
#position_endstop: 0
position_max: 420
position_min: -20

# Z1
[stepper_z1]
step_pin: PB5
dir_pin: PB6
enable_pin: !PB4
microsteps: 16
rotation_distance: 8
endstop_pin: PB7


[extruder]
nozzle_diameter: 0.600
filament_diameter: 1.7500
heater_pin: PE9
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC0
min_temp: 0
max_temp: 250
#pressure_advance: 0.7
#pressure_advance_smooth_time: 0.1

#step_pin: PE4
#dir_pin: PE5
#enable_pin: !PE3
#microsteps: 16
#rotation_distance: 7.8
max_extrude_only_distance: 100.0
min_extrude_temp: 0 #debugging only!

[extruder_stepper extruder1] 
step_pin: PB9
dir_pin: PE0
enable_pin: !PB8
microsteps: 16
rotation_distance: 7.319
#rotation_distance: 24.2?
#gear_ratio: 3:1
full_steps_per_rotation: 200
extruder: extruder

[extruder_stepper extruder2]
step_pin: PE4
dir_pin: PE5
enable_pin: !PE3
microsteps: 16
rotation_distance: 7.331
#rotation_distance: 24.2?
#gear_ratio: 3:1
full_steps_per_rotation: 200
extruder: extruder

[extruder_stepper extruder3]
step_pin: PC14
dir_pin: PC15
enable_pin: !PC13
microsteps: 16
rotation_distance: 7.418
#rotation_distance: 24.2?
#gear_ratio: 3:1
full_steps_per_rotation: 200
extruder: extruder

[filament_switch_sensor filament_sensor_1]
switch_pin: !PE2

[filament_switch_sensor filament_sensor_2]
switch_pin: !PE6

[filament_switch_sensor filament_sensor_3]
switch_pin: !PE1

[fan]
pin: PA6
off_below: 0.25

[heater_bed]
heater_pin: PE14
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC3
#control: watermark
min_temp: 0
max_temp: 90

[bed_screws]
screw1: 40, 40
screw2: 280, 40
screw3: 40, 280
screw4: 280, 280

[screws_tilt_adjust]
screw1_name: front left screw
screw1: 79, 45
screw2_name: front right screw
screw2: 319, 45
screw3_name: rear left screw
screw3: 79, 285
screw4_name: rear right screw
screw4: 319, 285
horizontal_move_z: 5
speed: 50
screw_thread: CW-M3

#[z_tilt]
#z_positions: -27, 160
#             347, 160
#points:       39, 160
#             320, 160
#speed: 200
#horizontal_move_z: 4
#retries: 10
#retry_tolerance: 0.003
          
[bltouch]
sensor_pin: ^PB3
control_pin: PA0
x_offset: -39
y_offset: 0
#z_offset: see below
speed: 2.0
samples: 3
lift_speed: 5.0
sample_retract_dist: 2.0

[bed_mesh]
speed: 150
horizontal_move_z: 6
mesh_min: 20, 20
mesh_max: 273, 305
algorithm: bicubic
bicubic_tension: .2
probe_count: 5
mesh_pps: 2, 2
#fade_start: 1
#fade_end: 10
#fade_target: 0
#move_check_distance: 5
#split_delta_z: .025

[firmware_retraction]
retract_length: 8
retract_speed: 30
unretract_extra_length: -0.25
unretract_speed: 25

[safe_z_home]
home_xy_position: 0, -5
speed: 50.0
z_hop: 10
z_hop_speed: 5
move_to_previous: False

[exclude_object]

[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0

[mcu rpi]
serial: /tmp/klipper_host_mcu

[idle_timeout]
#gcode:
#   A list of G-Code commands to execute on an idle timeout. See
#   docs/Command_Templates.md for G-Code format. The default is to run
#   "TURN_OFF_HEATERS" and "M84".
timeout: 3600
#   Idle time (in seconds) to wait before running the above G-Code
#   commands. The default is 600 seconds.

[printer]
kinematics: cartesian
max_velocity: 250
max_accel: 700
max_z_velocity: 30
max_z_accel: 70

############### Temperature Graph ###############
#Plot RPi temp: 
[temperature_sensor raspberry_pi]
sensor_type: temperature_host
max_temp: 100

#Plot MCU temp:
[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
max_temp: 100

### Make sure to delete BLTouch Offset and Z Offset on new printers ###

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 50.059
#*# pid_ki = 3.034
#*# pid_kd = 206.495
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 74.834
#*# pid_ki = 1.111
#*# pid_kd = 1260.015
#*#
#*# [stepper_z]
#*# position_endstop = -0.922
#*#
#*# [bltouch]
#*# z_offset = 1.640
#*#
#*# [bed_mesh 15x15]
#*# version = 1
#*# points =
#*# 	-0.038992, -0.017326, -0.003159, 0.001841, 0.048508, 0.076841, 0.083508, 0.056841, 0.073508, 0.079341, 0.041008, 0.009341, -0.001492, -0.038992, -0.111492
#*# 	-0.029826, -0.016492, 0.001008, -0.002326, 0.058508, 0.084341, 0.091841, 0.076008, 0.090174, 0.094341, 0.062674, 0.040174, 0.044341, -0.004826, -0.077326
#*# 	-0.018992, 0.008508, 0.015174, 0.018508, 0.079341, 0.115174, 0.113508, 0.091008, 0.098508, 0.098508, 0.061841, 0.051008, 0.046841, 0.010174, -0.043159
#*# 	-0.002326, 0.010174, 0.015174, 0.016008, 0.082674, 0.116008, 0.127674, 0.101841, 0.120174, 0.119341, 0.089341, 0.075174, 0.071841, 0.039341, -0.028992
#*# 	-0.006492, 0.016841, 0.025174, 0.029341, 0.093508, 0.121841, 0.124341, 0.103508, 0.126008, 0.128508, 0.110174, 0.104341, 0.085174, 0.055174, 0.002674
#*# 	0.001008, 0.021841, 0.014341, 0.016841, 0.081841, 0.111841, 0.121008, 0.094341, 0.161841, 0.122674, 0.093508, 0.071008, 0.081841, 0.047674, -0.021492
#*# 	0.005174, 0.037674, 0.041008, 0.045174, 0.095174, 0.124341, 0.132674, 0.111841, 0.119341, 0.126841, 0.096008, 0.080174, 0.077674, 0.063508, 0.009341
#*# 	0.006841, 0.033508, 0.041841, 0.038508, 0.092674, 0.127674, 0.155174, 0.119341, 0.136008, 0.138508, 0.116841, 0.097674, 0.094341, 0.086008, 0.032674
#*# 	0.044341, 0.062674, 0.081841, 0.071008, 0.126841, 0.161841, 0.163508, 0.129341, 0.143508, 0.150174, 0.117674, 0.090174, 0.088508, 0.088508, 0.038508
#*# 	0.061008, 0.086841, 0.087674, 0.086841, 0.137674, 0.166841, 0.193508, 0.147674, 0.162674, 0.167674, 0.130174, 0.121008, 0.115174, 0.091841, 0.049341
#*# 	0.031841, 0.075174, 0.072674, 0.078508, 0.124341, 0.154341, 0.156008, 0.121008, 0.126841, 0.131008, 0.096841, 0.081008, 0.091008, 0.059341, 0.012674
#*# 	0.011841, 0.045174, 0.049341, 0.046841, 0.116841, 0.123508, 0.145174, 0.116008, 0.120174, 0.129341, 0.087674, 0.068508, 0.083508, 0.053508, 0.004341
#*# 	0.031841, 0.056008, 0.076841, 0.076008, 0.120174, 0.149341, 0.155174, 0.121008, 0.125174, 0.162674, 0.087674, 0.061008, 0.053508, 0.045174, -0.003992
#*# 	0.007674, 0.044341, 0.051008, 0.049341, 0.106008, 0.131008, 0.159341, 0.123508, 0.126008, 0.126841, 0.081841, 0.058508, 0.052674, 0.041008, -0.010659
#*# 	0.010174, 0.052674, 0.077674, 0.064341, 0.113508, 0.128508, 0.146008, 0.106841, 0.116841, 0.114341, 0.067674, 0.046008, 0.032674, 0.021008, -0.031492
#*# min_x = 20.0
#*# max_x = 272.98
#*# min_y = 20.0
#*# max_y = 304.9
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 0
#*# mesh_y_pps = 0
#*# algo = bicubic
#*# tension = 0.2
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.200333, -0.155333, -0.113667, -0.143667, -0.240333
#*# 	  -0.122000, -0.088667, -0.047833, -0.076167, -0.147000
#*# 	  -0.057833, -0.032833, 0.011333, -0.037833, -0.080333
#*# 	  -0.091167, -0.074500, -0.044500, -0.080333, -0.121167
#*# 	  -0.231167, -0.162000, -0.119500, -0.160333, -0.202833
#*# x_count = 5
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 273.0
#*# min_y = 20.0
#*# max_y = 305.0
#*#
#*# [bed_mesh WORKING 5x5]
#*# version = 1
#*# points =
#*# 	-0.212000, -0.142833, -0.077000, -0.097833, -0.222000
#*# 	-0.108667, -0.057833, 0.004667, -0.025333, -0.105333
#*# 	-0.042000, 0.028833, 0.085500, 0.048000, -0.010333
#*# 	-0.077833, -0.002000, 0.058000, 0.020500, -0.046167
#*# 	-0.221167, -0.073667, 0.017167, -0.023667, -0.115333
#*# min_x = 20.0
#*# max_x = 273.0
#*# min_y = 20.0
#*# max_y = 305.0
#*# x_count = 5
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
